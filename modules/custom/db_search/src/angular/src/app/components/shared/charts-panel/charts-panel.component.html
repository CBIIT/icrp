<form [formGroup]="form" class="text-center">
  <div class="chart-type-selector" *ngIf="sharedService.get('authenticated')">
    <label>
      <input
        type="radio"
        name="display_type"
        value="project_counts"
        [formControl]="form.controls.display_type">
      Project Counts
    </label>

    <label>
      <input
        type="radio"
        name="display_type"
        value="award_amounts"
        [formControl]="form.controls.display_type">
      Award Amounts (USD)
    </label>

    <div *ngIf="fields && fields.conversion_years" [ngClass]="{
      'disabled': (form.controls.display_type.value === 'project_counts'),
      'inline-block': true
    }">
      Use Currency Rates From
      <select
        (change)="updateFundingCharts()"
        [formControl]="form.controls.conversion_year"
      >
        <option *ngFor="let year of fields.conversion_years" [value]="year.value">{{ year.label }}</option>
      </select>
    </div>
  </div>
</form>


<div class="row form-group" *ngIf="form.controls.display_type.value === 'project_counts'">
  <div class="col-sm-6 col-md-3 text-center">


    <div style="position: relative">
      <ui-chart
        type="pie"
        label="Projects by PI Country"
        primaryKey="project_count"
        [data]="analytics.project_counts_by_country && analytics.project_counts_by_country.results">
      </ui-chart>
    </div>
  </div>

  <div class="col-sm-6 col-md-3 text-center">
    <ui-chart
      type="pie"
      label="Projects by CSO"
      primaryKey="relevance"
      [data]="analytics.project_counts_by_cso_research_area && analytics.project_counts_by_cso_research_area.results">
    </ui-chart>
  </div>

  <div class="col-sm-6 col-md-3 text-center">
    <ui-chart
      type="pie"
      label="Projects by Cancer Type"
      primaryKey="relevance"
      [data]="analytics.project_counts_by_cancer_type && analytics.project_counts_by_cancer_type.results">
    </ui-chart>
  </div>


  <div class="col-sm-6 col-md-3 text-center">
    <ui-chart
      type="pie"
      label="Projects by Type"
      primaryKey="project_count"
      [data]="analytics.project_counts_by_type && analytics.project_counts_by_type.results">
    </ui-chart>
  </div>
</div>

<div class="row form-group" *ngIf="form.controls.display_type.value === 'award_amounts'">
  <div class="col-sm-6 col-md-3 text-center">

    <div style="position: relative">
      <ui-chart
        type="pie"
        label="Amounts by PI Country"
        primaryKey="funding_amount"
        [data]="analytics.project_funding_amounts_by_country && analytics.project_funding_amounts_by_country?.results">
      </ui-chart>
    </div>
  </div>

  <div class="col-sm-6 col-md-3 text-center">
    <ui-chart
      type="pie"
      label="Amounts by CSO"
      primaryKey="funding_amount"
      [data]="analytics.project_funding_amounts_by_cso_research_area && analytics.project_funding_amounts_by_cso_research_area?.results">
    </ui-chart>
  </div>

  <div class="col-sm-6 col-md-3 text-center">
    <ui-chart
      type="pie"
      label="Amounts by Cancer Type"
      primaryKey="funding_amount"
      [data]="analytics.project_funding_amounts_by_cancer_type && analytics.project_funding_amounts_by_cancer_type?.results">
    </ui-chart>
  </div>


  <div class="col-sm-6 col-md-3 text-center">
    <ui-chart
      type="pie"
      label="Amounts by Project Type"
      primaryKey="funding_amount"
      [data]="analytics.project_funding_amounts_by_type && analytics.project_funding_amounts_by_type?.results">
    </ui-chart>
  </div>
</div>


<div class="form-group clearfix" *ngIf="sharedService.get('authenticated')">

  <div [hidden]="!showMore" class="clearfix">
    <ui-chart
      *ngIf="form.controls.display_type.value === 'project_counts'"
      type="line"
      label="Project Counts by Year"
      primaryKey="project_count"
      xAxisLabel="Year"
      yAxisLabel="Project Counts"
      tooltipDescriptor="Projects"
      [data]="analytics.project_counts_by_year && analytics.project_counts_by_year.results">
    </ui-chart>

    <ui-chart
      *ngIf="form.controls.display_type.value === 'award_amounts'"
      type="line"
      label="Amounts by Year"
      primaryKey="funding_amount"
      xAxisLabel="Year"
      yAxisLabel="Amount (USD)"
      tooltipDescriptor="USD"
      [data]="analytics.project_funding_amounts_by_year && analytics.project_funding_amounts_by_year.results">
    </ui-chart>

  </div>

  <div class="text-center">
    <button class="btn btn-primary btn-xs text-center" (click)="showMore = !showMore; updateCharts();">Show {{ showMore ? 'Less' : 'More' }}</button>
  </div>

</div>


