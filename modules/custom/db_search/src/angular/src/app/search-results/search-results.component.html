<div class="search-criteria-summary" (click)="!showCriteriaLocked && showCriteria = !showCriteria">
  <span [ngClass]="{'glyphicon': true, 'glyphicon-triangle-right': !showCriteria, 'glyphicon-triangle-bottom': showCriteria}"></span>
  {{ searchCriteriaSummary }}</div>
<div class="search-criteria" *ngIf="showCriteria">
  {{ criteriaGroup | json }}

  <div *ngFor="let group of searchCriteriaGroups">
    <b>{{ group.category }}</b>

    <ul *ngIf="group.type === 'array'">
      <li *ngFor="let criteria of group.criteria">{{ criteria }}</li>
    </ul>

    <span *ngIf="group.type === 'single'">
      : {{ group.criteria[0] }}
    </span>

  </div>
</div>


<div class="row" style="margin-top: 10px">


  <div class="col-md-12 text-center clearfix loading-wrapper" style="padding-top: 140px; position: absolute" *ngIf="loadingAnalytics">
    Loading Charts...
  </div>

  <div class="col-md-3">
    <ui-chart
      label="Projects by Country"
      type="pie"
      [data]="(analytics && analytics.projects_by_country) || []">
    </ui-chart>
  </div>

  <div class="col-md-3">
    <ui-chart
      label="Projects by CSO"
      type="pie"
      [data]="(analytics && analytics.projects_by_cso_category) || []">
    </ui-chart>
  </div>

  <div class="col-md-3">
    <ui-chart
      label="Projects by Cancer Type"
      type="pie"
      [data]="(analytics && analytics.projects_by_cancer_type) || []"></ui-chart>
  </div>

  <div class="col-md-3">
    <ui-chart
      label="Projects by Type"
      type="pie"
      [data]="(analytics && analytics.projects_by_type) || []"></ui-chart>
  </div>
</div>


<div class="row" style="margin-top: 8px; margin-bottom: 5px;">
  <button class="btn btn-xs btn-default" (click)="emailResultsModal.show()">
    <span class="glyphicon glyphicon-envelope"></span>
    Email results</button>
  <button class="btn btn-xs btn-default" (click)="downloadResult(downloadResultsModal)">
    <span class="glyphicon glyphicon-download-alt"></span>
    Export results</button>
</div>



<div class="modal fade" bsModal #emailResultsModal="bs-modal" [config]="{backdrop: 'static'}"
     tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" aria-label="Close" (click)="emailResultsModal.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">Email Search Results</h4>
      </div>

      <div class="modal-body" >


		<div class="container">
			<label>Complete the form below to email a link to your search results to yourself, a friend, or colleague.</label>
			<br/><br/>
		</div>

		<form class="form-horizontal clearfix" [formGroup]="emailForm"  style="position: relative">

		  <div class="form-group">
		    <label for="name" class="col-sm-3 control-label">Your Name</label>
			<div class="col-sm-9">
			  <input type="text" class="input" id="recipientName" placeholder="Your Name" [formControl]="emailForm.controls.name" #name/>
	      	</div>
		  </div>

		  <div class="form-group">
		    <label for="recipientEmail" class="col-sm-3 control-label">Recipient's Email</label>
			<div class="col-sm-9">
			  <textarea class="input" id="recipientEmail" placeholder="(Separating multiple email recipients by commas)" [formControl]="emailForm.controls.recipient_email" #recipientemail></textarea>
			  <div *ngIf="!emailForm.controls.recipient_email.valid && !emailForm.controls.recipient_email.pristine" style="color: red;">Please ensure that the email addresses entered are valid</div>
	      	</div>
		  </div>

		  <div class="form-group">
			  <label for="recipientMessage" class="col-sm-3 control-label">Personal Message </label>
			  <div class="col-sm-9">
				<textarea class="input" id="recipientMessage" type="text" placeholder="(Optional)" [formControl]="emailForm.controls.personal_message"></textarea>
			  </div>
		  </div>

		  <div class="text-center" >
		  		<button class="btn btn-primary"  [disabled]="!emailForm.valid" (click)="sendEmail(emailResultsModal,emailMessageModal)">Send Email</button>
		  </div>
		 </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" bsModal #emailMessageModal="bs-modal" [config]="{backdrop: 'static'}"
     tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" aria-label="Close" (click)="emailMessageModal.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">Email Message</h4>
      </div>
      <div class="modal-body" style="position: relative">
		<div class="row">
			<div class="col-md-12"  style="text-align:center;">
				<p><b>The email has been sent out successfully!</b></p>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12">&nbsp;</div>
		</div>

		<div class="row">
			<div class="col-md-12" align="center">
				<button type="button" class="btn btn-primary" (click)="emailMessageModal.hide()">OK</button>
			</div>
		</div>
      	<br/><br/>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" bsModal #downloadResultsModal="bs-modal" [config]="{backdrop: 'static'}"
     tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" aria-label="Close" (click)="downloadResultsModal.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">Download Search Results</h4>
      </div>
      <div class="modal-body">
      	<div class="loading-wrapper">
			<div class="row">
				<div align="center"><b>Processing Data ...</b></div>
			</div>
			<div class="row">
				<div align="center">&nbsp;</div>
			</div>
			<div class="row">
				<div align="center">&nbsp;</div>
			</div>
      		<div class="row">
				<div class="col-md-3">&nbsp;</div>
				<div class="col-md-5">
					<div class="loading" align="center"></div>
				</div>
				<div class="col-md-4">&nbsp;</div>
      		</div>
      	</div>

      </div>
    </div>
  </div>
</div>


<div class="row">
  <ui-table
    [data]="projectData"
    [columns]="projectColumns"
    [loading]="loading"
    [pageSizes]="[50, 100, 150, 200, 250, 300]"
    [numResults]="(analytics && analytics.count) || 0"
    (paginate)="paginate.emit($event)"
    (sort)="sort.emit($event)">
  </ui-table>
</div>