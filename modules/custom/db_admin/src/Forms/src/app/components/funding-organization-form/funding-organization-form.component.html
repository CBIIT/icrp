<alert *ngFor="let message of messages" [type]="message.type" dismissible="true">
  {{ message.text }}
</alert>

<form
  class="vertical-margins"
  fxLayout
  fxLayoutWrap
  fxLayoutGap="15px"
  [formGroup]="form"
  (ngSubmit)="submit()">

  <div
    class="bordered padded form-group"
    fxLayout
    fxLayoutWrap
    fxLayoutAlign="start center"
    fxLayoutGap="15px"
    fxFlex="100%">

    <div
      [ngClass]="{'has-error': form.controls.partner.dirty
        && form.controls.partner.invalid}"
      ngClass.lt-md="form-group"
      fxLayout
      fxLayoutWrap
      fxFlex="calc(50% - 15px)"
      fxFlex.lt-md="100%"
      fxLayoutAlign="start center"
      fxLayoutGap="10px">
      <label
        class="control-label nowrap asterisk"
        for="partner"
        fxFlex="calc(20% - 10px)"
        fxFlex.lt-md="100%">
        Partner
      </label>
      <select
        fxFlex="calc(80% - 10px)"
        fxFlex.lt-md="100%"
        id="partner"
        name="partner"
        class="form-control input-sm"
        formControlName="partner"
        [ngSwitch]="options.partners.length">
        <option *ngSwitchCase="0" value="" hidden>Loading...</option>
        <option *ngSwitchDefault value="" hidden>Select a partner</option>
        <option *ngFor="let partner of options.partners" [value]="partner.value">
          {{ partner.label }}
        </option>
      </select>
      <div
        class="help-block"
        fxFlex="100%"
        *ngIf="form.controls.partner.dirty
          && form.controls.partner.errors?.required">
          This field is required.
      </div>
    </div>

    <div
      ngClass.lt-md="form-group"
      fxLayout
      fxLayout.lt-md="column"
      fxLayoutWrap
      fxFlex="calc(50% - 15px)"
      fxFlex.lt-md="100%"
      fxLayoutGap="15px"
      fxLayoutGap.lt-md="5px">
        <label
          class="control-label asterisk" for="memberType">
          Member Type
        </label>
        <input
          type="hidden"
          id="memberType"
          aria-label="This fieldset contains two radio buttons to select whether the chosen organization is a partner or an associate.">

        <label class="inline normal-weight" for="memberTypePartner">
          <input
            id="memberTypePartner"
            type="radio"
            name="memberType"
            value="Partner"
            formControlName="memberType">
          Partner
        </label>

        <label class="inline normal-weight" for="memberTypeAssociate">
          <input
            id="memberTypeAssociate"
            type="radio"
            name="memberType"
            value="Associate"
            formControlName="memberType">
          Associate
        </label>
        <div
          fxFlex="100%"
          *ngIf="form.controls.partner.dirty && form.controls.partner.invalid">
          &zwj;
        </div>
    </div>
  </div>

  <div
    class="form-group"
    [ngClass]="{'has-error': form.controls.name.dirty
      && form.controls.name.invalid}"
    fxFlex="calc(50% - 15px)"
    fxFlex.lt-md="100%">
    <div>
      <label
        for="name"
        class="control-label asterisk">
        Name
      </label>
      <input
        id="name"
        name="name"
        class="form-control input-sm"
        placeholder="Enter name of funding organization (100 characters maximum)"
        maxlength="100"
        [formControl]="form.controls.name">
    </div>
    <div class="help-block"
      *ngIf="form.controls.name.dirty
        && form.controls.name.errors?.required">
        This field is required.
    </div>
  </div>

  <div
    class="form-group"
    [ngClass]="{'has-error': form.controls.abbreviation.dirty
      && form.controls.abbreviation.invalid}"
    fxFlex="calc(50% - 15px)"
    fxFlex.lt-md="100%">
    <div>
      <label
        class="control-label"
        for="abbreviation">
        Abbreviation <span class="text-danger">*</span>
      </label>
      <input
        id="abbreviation"
        name="abbreviation"
        class="form-control input-sm"
        placeholder="Enter abbreviation for funding organization (15 characters maximum)"
        maxlength="15"
        [formControl]="form.controls.abbreviation">
    </div>
    <div class="help-block"
      *ngIf="form.controls.abbreviation.dirty
        && form.controls.abbreviation.errors?.required">
      This field is required.
    </div>
  </div>

  <div
    class="form-group"
    [ngClass]="{'has-error': form.controls.organizationType.dirty
      && form.controls.organizationType.invalid}"
    fxFlex="calc(50% - 15px)"
    fxFlex.lt-md="100%">
    <label
      class="control-label asterisk"
      for="organizationType">
      Organization Type
    </label>
    <select
      id="organizationType"
      name="organizationType"
      class="form-control input-sm"
      [formControl]="form.controls.organizationType">
      <option value="" hidden>Select an organization type</option>
      <option>Government</option>
      <option>Non-profit</option>
      <option>Other</option>
    </select>
    <div class="help-block"
      *ngIf="form.controls.organizationType.dirty
        && form.controls.organizationType.errors?.required">
      This field is required.
    </div>
  </div>

  <div
    class="form-group"
    [ngClass]="{'has-error': (form.controls.latitude.dirty && form.controls.latitude.invalid)
      || (form.controls.longitude.dirty && form.controls.longitude.invalid)}"
    fxFlex="calc(50% - 15px)"
    fxFlex.lt-md="100%">
    <label
      class="control-label asterisk"
      for="mapCoordinates">
      Map Coordinates
    </label>
    <input
      type="hidden"
      id="mapCoordinates"
      aria-label="This fieldset contains two text input fields to enter the longitude and latitude of the funding organization.">

    <div
      fxLayout="row"
      fxLayout.lt-md="column"
      fxLayoutGap="15px"
      fxLayoutGap.lt-md="10px"
      >
      <input
        id="latitude"
        name="latitude"
        class="form-control input-sm"
        type="number"
        placeholder="Enter latitude (eg: 32.30642)"
        fxFlex
        fxFlex.lt-md="nogrow"
        max="90"
        min="-90"
        step="0.01"
        [formControl]="form.controls.latitude">

      <input
        id="longitude"
        name="longitude"
        class="form-control input-sm"
        type="number"
        placeholder="Enter longitude (eg: -122.61458)"
        fxFlex
        fxFlex.lt-md="nogrow"
        max="180"
        min="-180"
        step="0.01"
        [formControl]="form.controls.longitude">
    </div>

    <div class="help-block"
      *ngIf="(form.controls.latitude.dirty && form.controls.latitude.errors?.required)
        || (form.controls.longitude.dirty && form.controls.longitude.errors?.required)">
      Both fields are required.
    </div>

    <div class="help-block"
      *ngIf="form.controls.latitude.dirty
        && (form.controls.latitude.errors?.min || form.controls.latitude.errors?.max)">
      The latitude should be provided as a decimal number between -90.0 and 90.0 inclusive.
    </div>

    <div class="help-block"
      *ngIf="form.controls.longitude.dirty
        && (form.controls.longitude.errors?.min || form.controls.longitude.errors?.max)">
      The longitude should be provided as a decimal number between -180.0 and 180.0 inclusive.
    </div>
  </div>


  <div
    class="form-group"
    [ngClass]="{'has-error': form.controls.country.dirty
      && form.controls.country.invalid}"
    fxFlex="calc(50% - 15px)"
    fxFlex.lt-md="100%">
    <label
      class="control-label asterisk"
      for="country">
      Country
    </label>
    <select
      id="country"
      name="country"
      class="form-control input-sm"
      [formControl]="form.controls.country"
      [ngSwitch]="options.countries.length">
      <option *ngSwitchCase="0" value="" hidden>Loading...</option>
      <option *ngSwitchDefault value="" hidden>Select a country</option>
      <option *ngFor="let country of options.countries" [value]="country.value">
        {{ country.label }}
      </option>
    </select>

    <div class="help-block"
      *ngIf="form.controls.country.dirty
        && form.controls.country.errors?.required">
      This field is required.
    </div>
  </div>

  <div
    class="form-group"
    [ngClass]="{'has-error': form.controls.currency.dirty
      && form.controls.currency.invalid}"
    fxFlex="calc(50% - 15px)"
    fxFlex.lt-md="100%">
    <label
      class="control-label asterisk"
      for="currency">
      Currency
    </label>
    <select
      id="currency"
      name="currency"
      class="form-control input-sm"
      [formControl]="form.controls.currency"
      [ngSwitch]="options.currencies.length">
      <option *ngSwitchCase="0" value="" hidden>Loading...</option>
      <option *ngSwitchDefault value="" hidden>Select a currency</option>
      <option *ngFor="let currency of options.currencies" [value]="currency.value">
        {{ currency.label }}
      </option>
    </select>

    <div class="help-block"
      *ngIf="form.controls.currency.dirty
        && form.controls.currency.errors?.required">
      This field is required.
    </div>
  </div>

  <div
    class="form-group"
    fxFlex="100%">
      <label for="note">Note</label>
      <textarea
        id="note"
        name="note"
        class="form-control vertical-resize default-min-height"
        placeholder="Enter note (optional, 1000 characters maximum)"
        rows="3"
        maxlength="8000"
        [formControl]="form.controls.note">
      ></textarea>
  </div>

  <div
    class="form-group"
    fxLayout
    fxLayoutWrap
    fxLayoutAlign="space-between center"
    fxFlex="100%">
    <label class="inline" for="annualizedFunding">
      <input
        id="annualizedFunding"
        type="checkbox"
        name="annualizedFunding"
        [formControl]="form.controls.annualizedFunding">
      Annualized Funding
    </label>

    <i class="text-muted">* indicates required fields</i>
  </div>

  <div fxFlex="100%" fxLayoutAlign="center center" fxLayoutGap="10px">
    <button type="submit" class="btn btn-primary standard-width">Save</button>
    <button class="btn btn-default standard-width" (click)="resetForm($event)">Cancel</button>
  </div>
</form>